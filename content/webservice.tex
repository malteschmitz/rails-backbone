%\begin{frame}{}
%  \begin{itemize}
%    \item item
%  \end{itemize}
%\end{frame}

\colorlet{maincolor}{bordeaux} % Color section in bordeaux
\lstset{
  language=Ruby,
  gobble=4,
  basicstyle=\ttfamily\small
}

\section[Webservice]{Webservice mit Rails 3.2}

\begin{frame}{Was ist Rails}
  \begin{itemize}
    \item Ruby on Rails Web-Framework
    \item Annahmen über \enquote{The Rails Way}
    \item Folgt Prinzipien
    \begin{itemize}
      \item DRY -- \enquote{Don’t Repeat Yourself}
      \item Convention Over Configuration
      \item REST-Architekturstil
    \end{itemize}
  \end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Model-View-Controller}

\begin{frame}[fragile]{Model-View-Controller}
  \begin{center}
    \input{images/model-view-controller}
  \end{center}
\end{frame}

\begin{frame}{Models}
  \begin{itemize}
    \item Repräsentieren Daten
    \item Interagieren mit der Datenbank
    \item Enthalten Applikationslogik
    \item Häufig: Model $\hat =$ Datenbank-Tabelle
  \end{itemize}
\end{frame}

\begin{frame}{Views}
  \begin{itemize}
    \item Bieten Benutzungsschnittstelle der Applikation
    \item Präsentieren ausschließlich Daten
    \item Liefern Daten aus
    \item Häufig: HTML-Dokumente mit eingebettetem Ruby-Code
  \end{itemize}
\end{frame}

\begin{frame}{Controllers}
  \begin{itemize}
    \item Integrieren Views und Models
    \item Verarbeiten Anfragen
    \item Rufen Daten beim Model ab
    \item Liefern Daten zum View
  \end{itemize}
\end{frame}

\begin{frame}{Komponentenübersicht}
  \begin{center}
    \input{images/server-arch}
  \end{center}
\end{frame}

\begin{frame}{RESTful Rails}
  \begin{itemize}
    \item Addressierung von Ressourcen durch URIs
    \item Austausch von Zustands-Repräsentationen
    \item Zwei URIs
    \begin{itemize}
      \item Collection-URI \\ \lstinline|GET /users|
      \item Item-URI \\ \lstinline|GET /users/42|
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]{RESTful Rails}
  \newcommand{\coord}[1]{\tikz[remember picture]{\node[coordinate](#1){};}}

  \begin{center}
    \begin{zebratabular}{lll}\headerrow
      Aktion  & Methode & Bedeutung \\
      index   & GET     & Abrufen aller Entitäten \\
      create  & POST    & Anlegen einer Entität \\
      show    & GET     & Abrufen einer Entität \\
      update  & PUT     & Aktualisieren einer Entität \\
      destroy & DELETE  & Löschen einer Entität \\
      \coord{new left}new & GET & Formular zum Erzeugen\coord{new right}\\
      \coord{edit left}edit & GET & Formular zum Editieren\coord{edit right}
    \end{zebratabular}
  \end{center}

  \begin{tikzpicture}[remember picture,overlay]
    \only<2>{\draw[red,thick]
      ($(new left) + (-.5ex,.5ex) $) --
      ($(new right) + (.5ex,.5ex)$)
      ($(edit left) + (-.5ex,.5ex) $) --
      ($(edit right) + (.5ex,.5ex)$);}
  \end{tikzpicture}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Responder}

\begin{frame}[fragile]{Responder}
  Alte Implementierung:
  \begin{lstlisting}
    class PeopleController < ApplicationController
      def index
        @people = Person.all
        respond_to do |format|
          format.html # index.html.erb
          format.xml  { render :xml => @people}
          format.json { render :json => @people}
        end
      end

      ...
    end
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]{Responder}
  Neue Implementierung:
  \begin{lstlisting}
    class PeopleController < ApplicationController
      respond_to :html, :xml, :json

      def index
        @people = Person.all
        respond_with(@people)
      end

      ...
    end
  \end{lstlisting}
\end{frame}

\begin{frame}{Responder Ablauf}
  Request for an XML response:
  \begin{enumerate}
    \item search for a template in \lstinline|people/index.xml|
    \item invoke \lstinline|to_xml|
    \item call \lstinline|to_format|
  \end{enumerate}
\end{frame}

\begin{frame}[fragile]{HTTP-Semantik}
  \begin{lstlisting}
    def create
      @user = User.new(params[:user])
      if @user.save
        flash[:notice] = 'User created.'
      end
      respond_with(@user)
    end
  \end{lstlisting}

  \begin{description}
    \item[Erfolg] Status 201 Created
    \item[Fehler] Status 422 Unprocessable Entity
  \end{description}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Views}

\begin{frame}[fragile]{ERB Views}
  \begin{itemize}
    \item Ruby Code eingebettet in HTML-Dokumente
    \item Unterstützt Partials
  \end{itemize}

  \begin{lstlisting}[language=HTML]
    <h1>Hello, <%=h @user.name %></h1>
    <%= render @user %>
  \end{lstlisting}

  User Partial
  \begin{lstlisting}[language=HTML]
    <p>
      Good bye <%=h user.name =>
    </p>
  \end{lstlisting}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Assoziationen}

\frame{no content}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Validierung}

\frame{no content}


