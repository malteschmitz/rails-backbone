\colorlet{maincolor}{niceblue} % Color section in blue
\section[Client]{Client mit Backbone.js}

\begin{frame}{Architektur}
  \begin{center}
    \input{images/client-arch}
  \end{center}
\end{frame}

\begin{frame}{Backbone.js benötigt}
  \begin{itemize}
    \item Underscore.js \\
      \textcolor{gray}{\texttt{\_.each}, \texttt{\_.map},
      \texttt{\_.reduce}, \\
      \texttt{\_.all}, \texttt{\_.any}, \texttt{\_.contains}, \\
      \texttt{\_.escape}, \texttt{\_.result}, \texttt{\_.template},
      \ldots} \\[5ex]
    \item jQuery (oder zepto.js) \\
      \textcolor{gray}{\texttt{\$()}, \texttt{\$().html},
      \texttt{\$().append}, \\
      \texttt{\$().on}, \texttt{\$().addClass}, \texttt{\$().val}, \\
      \texttt{\$.ajax}, \ldots}
  \end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Modelle und Sammlungen}

\begin{frame}{Models}
  no content
\end{frame}

\begin{Frame}[fragile]{Events in Backbone}
  \begin{center}
    \input{images/events}
  \end{center}
\end{Frame}

\mode
<article>

Unterschiede zwischen Events in Backbone und der klassischen Realisierung
des Ovserver-Patterns in Java:
\begin{compactitem}
  \item Es gibt benannte Ereignisse, damit kann ein zu beobachtendes Objekt
    verschiedenen Mengen von Beobachtern haben, die bei unterschiedlichen
    Situationen benachrichtigt werden.
  \item Events werden nicht vorher registriert, dass heißt, das zu beobachtende
    Objekt ruft einfach \lstinline-trigger- mit dem Namen des Ereignisses auf.
  \item Ein Beobachter muss nicht sich als Objekt mit \lstinline-addListener-
    am zu beobachten Objekt registriert, sondern mit \lstinline-bind-
    eine (seiner) Methoden zusammen mit dem Namen des zu beobachtenden
    Ereignisses an das zu beobachtenden Objekt binden. Es werden also
    Funktionen statt Objekt als Ereignisbehandler übergeben.
\end{compactitem}

\mode
<all>

\begin{frame}{Collections}
  no content
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Ansichten}

\begin{frame}{Views}
  \begin{itemize}
    \item jQuery
    \item Events
  \end{itemize}
\end{frame}

\begin{frame}[fragile]{Templates}
  \begin{lstlisting}[language=JavaScript,gobble=4]
    var template = "Hello, <%=user %>!";
    this.template = _.template(template);
  \end{lstlisting}
  
  \begin{lstlisting}[language=JavaScript,gobble=4]
    function(obj){
      var __p = '';
      with (obj || {}) {
        __p += 'Hello, ' +
        (name) +
        '!';
      }
      return __p;
    }
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]{FormBuilder}
  \begin{lstlisting}[language=JavaScript,gobble=4]
    tag('p',
      {class: 'alert', id:'user'},
      'Nutzer nicht vorhanden');
  \end{lstlisting}
  \begin{lstlisting}[language=HTML,gobble=4]
    <p class="alert" id="user">
      Nutzer nicht vorhanden
    </p>
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]{FormBuilder}
  \begin{lstlisting}[language=JavaScript,gobble=4]
    formText('designator');
  \end{lstlisting}
  \begin{lstlisting}[language=HTML,gobble=4]
    <div
        class="control-group">
      <label
          for="designator"
          class="control-label">
        Bezeichner
      </label>
      <input
          type="text"
          id="designator"
          autocomplete="off"
          value="Veranstaltungsraum">
    </div>
  \end{lstlisting}
\end{frame}

\begin{frame}{Internationalization (I18N)}
  \begin{itemize}
    \item \lstinline[lang=JavaScript]-view.formText('designator')-\\
      \hfill\textcolor{gray}{ruft auf}\hfill\strut
    \item \lstinline[lang=JavaScript]-view.translate('models.' + this.model.name-\\
      \qquad  \lstinline[lang=JavaScript]-+ '.designator')-\\
      \hfill\textcolor{gray}{ruft auf}\hfill\strut
    \item \lstinline[lang=JavaScript]-i18n.getValue('models.room_type'-\\
      \qquad \lstinline[lang=JavaScript]- + '.designator')-\\
      \hfill\textcolor{gray}{ruft auf}\hfill\strut
    \item \lstinline[lang=JavaScript]-i18n.find('de.models.room_type'- \\
      \qquad \lstinline[lang=JavaScript]-+ '.designator')-\\
      \hfill\textcolor{gray}{basiert auf}\hfill\strut
    \item \lstinline[lang=JavaScript]-_.extend(YAML.eval(de), YAML.eval(en))-
  \end{itemize}
\end{frame}

\begin{frame}[fragile]{FormBuilder}
  \begin{lstlisting}[language=HTML,gobble=4]
    <h3>
      <%=t('.title') %>
      <%=model.escape('occasion') %>
    </h3>
    <p>
      <a href="#"><%=t('.back') %></a>
      | <a href="#"><%=t('.edit') %></a>
      | <a href="#"><%=t('.print') %></a>
    </p>
  \end{lstlisting}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Routing}

\begin{frame}{Routing}
  \begin{itemize}
    \item StateModel
    \item Router
    \item app.initialize()
  \end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection[AMD]{Asynchronous Module Definition (AMD)}

\tikzset{
  file index/.style={},
  file main/.style={},
  file model/.style={},
  file view/.style={},
  file template/.style={},
  file selected/.style={
    color=maincolor,
    font=\bfseries,
    execute at end node={\ \raisebox{.7ex}{\tikz[baseline]{\draw (0,0) edge[<-, ultra thick, maincolor] (0.5,0);}}}
  }
}

\begin{frame}{Asynchronous Module Definition}
  \begin{columns}
    \column{0.5\textwidth}
    {\large\bfseries\color{maincolor}klassisch}
    \setbeamertemplate{itemize item}{\badmark}
    \begin{itemize}
      \item Definitionen über direkt ausgeführten Code
      \item Bibliotheken über globale Variablen und \lstinline[language=HTML]-<script>-
      \item Reihenfolge der \lstinline[language=HTML]-<script>--Tags wichtig
      \item Kompression schwierig
    \end{itemize}
    \column{0.5\textwidth}
    {\large\bfseries\color{maincolor}mit Modulen}
    \setbeamertemplate{itemize item}{\goodmark}
    \begin{itemize}
      \item Definitionen über Funktion
      \item Bibliotheken über Laden von Abhängigkeiten
      \item Reihenfolge automatisch korrekt
      \item Tools zur Kompression
    \end{itemize}
  \end{columns}
\end{frame}

\begin{frame}{Asynchronous Module Definition\\ mit Require.js}
  \begin{center}
    \input{images/amd-tree}
  \end{center}
\end{frame}

\lstset{basicstyle=\ttfamily\scriptsize}

\begin{frame}[fragile,t]
  \tikzset{file index/.style={file selected}}
  \scalebox{0.5}{\input{images/amd-tree}}
  
  \vskip3ex
  
  \begin{lstlisting}[language=HTML,gobble=4]
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="utf-8">
        <script data-main="main" src="libs/require.js" />
      </head>
      <body>
        <div id="passat">
          <!-- application template -->
        </div>
      </body>
    </html>
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile,t]
  \tikzset{file main/.style={file selected}}
  \scalebox{0.5}{\input{images/amd-tree}}
  
  \vskip3ex
  
  \begin{lstlisting}[language=JavaScript,gobble=4]
    require.config({
      paths: {
        backbone: 'libs/backbone',
      },
      shim: {
        'backbone': {
          deps: ['underscore', 'jquery'],
          exports: 'Backbone'
        }
      }
    });
    require(['jquery', 'app/app'], function ($, app) {
      $(function () { app.initialize(); });
    });
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile,t]
  \tikzset{file model/.style={file selected}}
  \scalebox{0.5}{\input{images/amd-tree}}
  
  \vskip3ex
  
  \begin{lstlisting}[language=JavaScript,gobble=4]
    define(['backbone'], function (Backbone) {
      var OrderModel = Backbone.Model.extend({
        // methods of order
      });
      return OrderModel;
    });
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile,t]
  \tikzset{file view/.style={file selected}}
  \scalebox{0.5}{\input{images/amd-tree}}
  
  \vskip3ex
  
  \begin{lstlisting}[language=JavaScript,gobble=4]
    define(['jquery', 'backbone',
        'text!app/templates/orders/show.html'],
        function ($, Backbone, template) {
      var OrdersShowView = Backbone.View.extend({
        tagName: 'tr',
        template: _.template(template),
        initialize: function () {
          this.$el.html(this.template(this));
        }
      });
      return OrdersShowView;
    });
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile,t]
  \tikzset{file template/.style={file selected}}
  \scalebox{0.5}{\input{images/amd-tree}}
  
  \vskip3ex
  
  \begin{lstlisting}[language=HTML,gobble=4]
    <h3><%=t('.title') %></h3>
    <dl class="dl-horizontal">
      <%=showLegend(t('.order')) %>
      <%=showText('occasion') %>
    </dl>
  \end{lstlisting}
\end{frame}

\subsection{Dokumentation}

\begin{frame}[fragile]{RDoc}{app/models/oder.rb}
  \begin{lstlisting}[language=Ruby,gobble=4]
    # -*- encoding : utf-8 -*-
    # == Schema Information
    #
    # Table name: orders
    #
    #  id          :integer          not null, primary key
    #  customer_id :integer
    #  user_id     :integer          not null

    class Order < ActiveRecord::Base    
      # Checks if customer and user are set.
      def complete?
        !user.blank? && !customer.blank?
      end
    end
  \end{lstlisting}
  
  \vskip3ex
  
  \begin{lstlisting}[language={},gobble=4]
    rake doc:app
  \end{lstlisting}
\end{frame}

{
  \setbeamertemplate{background canvas}{\includegraphics[width=\paperwidth]{images/rdoc}}
  \frame[plain]{}
}

\begin{frame}[fragile]{JSDoc}{public/app/models/order.js}
  \begin{lstlisting}[language=JavaScript,gobble=4]
    define(['backbone', 'app/models/base'],
        function (Backbone, ApplicationModel) {
      /**
       @class OrderModel
       @augments ApplicationModel
       */
      var OrderModel = ApplicationModel.extend(
      /**
       @lends OrderModel#
       */
      {
        /**
         * Name of this model.
         */
        name: 'order'
      });
      return OrderModel;
    });
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]{JSDoc}{lib/tasks/jsdoc.rake}
  \begin{lstlisting}[language=Ruby,gobble=4]
    namespace :doc do
      desc "Generate docs for the client."
      task :client do
        `jsdoc -r -d doc/client public/main.js public/app`
        puts "Created doc/client."
      end
    end
  \end{lstlisting}  
  
  \vskip3ex

  \begin{lstlisting}[language={},gobble=4]
    rake doc:client
  \end{lstlisting}
\end{frame}

{
  \setbeamertemplate{background canvas}{\includegraphics[width=\paperwidth]{images/jsdoc}}
  \frame[plain]{}
}